{% extends "base.html" %}

{% block title %}Dashboard Gerencial{% endblock %}
{% block page_title %}Resumen de Operaciones{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-4 col-md-12 mb-4">
        <div class="card h-100">
            <div class="card-header p-3 pt-2 bg-transparent">
                <div class="icon icon-lg icon-shape bg-gradient-success shadow-success text-center border-radius-xl mt-n4 position-absolute">
                    <i class="material-icons opacity-10">attach_money</i>
                </div>
                <div class="text-end pt-1">
                    <p class="text-sm mb-0 text-capitalize">Ventas del Mes</p>
                    <h4 class="mb-0">{{ ventas_mes }} Rollos</h4>
                </div>
            </div>
            <hr class="horizontal dark my-0">
            <div class="card-body">
                <p class="mb-0 text-sm">Transferencias a instaladores realizadas este mes.</p>
                <div class="mt-4 text-center">
                    <a href="{{ url_for('admin.vender') }}" class="btn bg-gradient-dark mb-0">
                        <i class="material-icons text-sm">local_shipping</i> Ir a Vender
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-8 col-md-12 mb-4">
        <div class="card z-index-2 h-100">
            <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2 bg-transparent">
                <div class="bg-gradient-dark shadow-dark border-radius-lg py-3 pe-1">
                    <div class="chart">
                        <canvas id="chart-bars" class="chart-canvas" height="170"></canvas>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <h6 class="mb-0 ">Top Instaladores (Compras)</h6>
                <p class="text-sm ">Rendimiento de compra de tus clientes principales.</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header pb-0">
                <h6>游닍 Stock en Dep칩sito</h6>
            </div>
            <div class="card-body p-3">
                <ul class="list-group">
                    {% for item in stock_productos %}
                    <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                        <div class="d-flex align-items-center">
                            <div class="icon icon-shape icon-sm me-3 bg-gradient-info shadow text-center">
                                <i class="material-icons opacity-10">layers</i>
                            </div>
                            <div class="d-flex flex-column">
                                <h6 class="mb-1 text-dark text-sm">{{ item.nombre }}</h6>
                                <span class="text-xs">Disponible</span>
                            </div>
                        </div>
                        <div class="d-flex align-items-center text-success text-gradient text-sm font-weight-bold">
                            {{ item.cantidad }}
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                <div class="mt-3 text-center">
                    <a href="{{ url_for('admin.gestionar_stock') }}" class="btn btn-sm btn-outline-info w-100">Gestionar Stock</a>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header pb-0">
                <h6>游논 Instaladores Recientes</h6>
            </div>
            <div class="card-body p-3">
                <ul class="list-group">
                    {% for inst in instaladores %}
                    <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                        <div class="d-flex align-items-center">
                            <button class="btn btn-icon-only btn-rounded btn-outline-dark mb-0 me-3 btn-sm d-flex align-items-center justify-content-center">
                                <i class="material-icons text-sm">person</i>
                            </button>
                            <div class="d-flex flex-column">
                                <h6 class="mb-1 text-dark text-sm">{{ inst.username }}</h6>
                                <span class="text-xs">{{ inst.email }}</span>
                            </div>
                        </div>
                    </li>
                    {% else %}
                    <p class="text-xs">No hay instaladores.</p>
                    {% endfor %}
                </ul>
                <div class="mt-3 text-center">
                    <a href="{{ url_for('admin.gestionar_instaladores') }}" class="btn btn-sm btn-outline-dark w-100">Ver Todos</a>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header pb-0">
                <h6>游눯 Finanzas (Pr칩ximamente)</h6>
            </div>
            <div class="card-body p-3 text-center d-flex flex-column justify-content-center">
                <i class="material-icons text-secondary opacity-5" style="font-size: 4rem;">paid</i>
                <h5 class="mt-3">Gesti칩n de Precios</h5>
                <p class="text-sm text-secondary">Aqu칤 podr치s gestionar precios por rollo y ver balances.</p>
                <button class="btn btn-secondary btn-sm" disabled>En Desarrollo</button>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='assets/js/plugins/chartjs.min.js') }}"></script>
<script>
  var ctx = document.getElementById("chart-bars").getContext("2d");

  new Chart(ctx, {
    type: "bar",
    data: {
      labels: {{ chart_labels | tojson }}, // ["Taller A", "Taller B"]
      datasets: [{
        label: "Rollos Comprados",
        tension: 0.4,
        borderWidth: 0,
        borderRadius: 4,
        borderSkipped: false,
        backgroundColor: "rgba(255, 255, 255, .8)",
        data: {{ chart_values | tojson }}, // [10, 5]
        maxBarThickness: 6
      }, ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false }
      },
      interaction: {
        intersect: false,
        mode: 'index',
      },
      scales: {
        y: {
          grid: {
            drawBorder: false,
            display: true,
            drawOnChartArea: true,
            drawTicks: false,
            borderDash: [5, 5],
            color: 'rgba(255, 255, 255, .2)'
          },
          ticks: {
            suggestedMin: 0,
            suggestedMax: 10,
            beginAtZero: true,
            padding: 10,
            font: { size: 14, weight: 300, family: "Roboto", style: 'normal', lineHeight: 2 },
            color: "#fff"
          },
        },
        x: {
          grid: {
            drawBorder: false,
            display: true,
            drawOnChartArea: true,
            drawTicks: false,
            borderDash: [5, 5],
            color: 'rgba(255, 255, 255, .2)'
          },
          ticks: {
            display: true,
            color: '#f8f9fa',
            padding: 10,
            font: { size: 14, weight: 300, family: "Roboto", style: 'normal', lineHeight: 2 },
          }
        },
      },
    },
  });
</script>

{% endblock %}